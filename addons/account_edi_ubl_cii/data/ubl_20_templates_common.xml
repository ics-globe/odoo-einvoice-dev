<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="ubl_20_AddressType">
        <t xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
           xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
           xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
            <cbc:StreetName t-esc="vals.get('street_name')"/>
            <cbc:AdditionalStreetName t-esc="vals.get('additional_street_name')"/>
            <cbc:CityName t-esc="vals.get('city_name')"/>
            <cbc:PostalZone t-esc="vals.get('postal_zone')"/>
            <cbc:CountrySubentity t-esc="vals.get('country_subentity')"/>
            <cbc:CountrySubentityCode t-esc="vals.get('country_subentity_code')"/>
            <cac:Country>
                <t t-set="country_vals" t-value="vals.get('Country_vals', {})"/>
                <cbc:IdentificationCode
                    t-att="country_vals.get('identification_code_attrs', {})"
                    t-esc="country_vals.get('identification_code')"/>
                <cbc:Name t-esc="country_vals.get('name')"/>
            </cac:Country>
        </t>
    </template>

    <template id="ubl_20_PartyType">
        <t xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
           xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
           xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
            <t t-set="partner" t-value="vals.get('partner') or builder.env['res.partner']"/>

            <cbc:WebsiteURI t-esc="partner.website"/>
            <cbc:EndpointID
                    t-att="vals.get('endpoint_id_attrs', {})"
                    t-esc="vals.get('endpoint_id')"/>
            <t t-foreach="vals.get('PartyIdentification_vals', [])" t-as="party_vals">
                <cac:PartyIdentification>
                    <cbc:ID
                        t-att="party_vals.get('id_attrs', {})"
                        t-esc="party_vals.get('id')"/>
                </cac:PartyIdentification>
            </t>
            <t t-foreach="vals.get('PartyName_vals', [])" t-as="party_vals">
                <cac:PartyName>
                    <cbc:Name t-esc="party_vals.get('name')"/>
                </cac:PartyName>
            </t>
            <cac:PostalAddress>
                <t t-call="{{AddressType_template}}">
                    <t t-set="vals" t-value="vals.get('PostalAddress_vals', {})"/>
                </t>
            </cac:PostalAddress>
            <t t-foreach="vals.get('PartyTaxScheme_vals', [])" t-as="foreach_vals">
                <cac:PartyTaxScheme>
                    <cbc:RegistrationName t-esc="foreach_vals.get('registration_name')"/>
                    <cbc:CompanyID
                            t-att="foreach_vals.get('company_id_attrs', {})"
                            t-esc="foreach_vals.get('company_id')"/>
                    <cac:RegistrationAddress>
                        <t t-call="{{AddressType_template}}">
                            <t t-set="vals" t-value="foreach_vals.get('RegistrationAddress_vals', {})"/>
                        </t>
                    </cac:RegistrationAddress>
                    <cac:TaxScheme>
                        <cbc:ID t-esc="foreach_vals.get('tax_scheme_id')"/>
                    </cac:TaxScheme>
                </cac:PartyTaxScheme>
            </t>

            <t t-foreach="vals.get('PartyLegalEntity_vals', [])" t-as="foreach_vals">
                <cac:PartyLegalEntity>
                    <cbc:RegistrationName t-esc="foreach_vals.get('registration_name')"/>
                    <cbc:CompanyID
                            t-att="foreach_vals.get('company_id_attrs', {})"
                            t-esc="foreach_vals.get('company_id')"/>
                    <cac:RegistrationAddress>
                        <t t-call="{{AddressType_template}}">
                            <t t-set="vals" t-value="foreach_vals.get('RegistrationAddress_vals', {})"/>
                        </t>
                    </cac:RegistrationAddress>
                </cac:PartyLegalEntity>
            </t>
            <cac:Contact>
                <t t-set="vals" t-value="vals.get('Contact_vals', {})"/>
                <cbc:ID t-esc="vals.get('id')"/>
                <cbc:Name t-esc="vals.get('name')"/>
                <cbc:Telephone t-esc="vals.get('telephone')"/>
                <cbc:ElectronicMail t-esc="vals.get('electronic_mail')"/>
            </cac:Contact>
        </t>
    </template>

    <template id="ubl_20_PaymentMeansType">
        <t xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
           xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
           xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
            <cbc:PaymentMeansCode
                    t-att="vals.get('payment_means_code_attrs', {})"
                    t-esc="vals.get('payment_means_code')"/>
            <cbc:PaymentDueDate t-esc="vals.get('payment_due_date')"/>
            <cbc:InstructionID t-esc="vals.get('instruction_id')"/>
            <t t-foreach="vals.get('payment_id_vals', [])" t-as="payment_id">
                <cbc:PaymentID t-esc="payment_id"/>
            </t>
            <cac:PayeeFinancialAccount>
                <t t-set="foreach_vals" t-value="vals.get('PayeeFinancialAccount_vals', {})"/>
                <cbc:ID
                    t-att="foreach_vals.get('id_attrs', {})"
                    t-esc="foreach_vals.get('id')"/>
                <cac:FinancialInstitutionBranch>
                    <t t-set="financial_inst_vals" t-value="foreach_vals.get('FinancialInstitutionBranch_vals', {})"/>
                    <cbc:ID
                        t-att="financial_inst_vals.get('id_attrs', {})"
                        t-esc="financial_inst_vals.get('id')"/>
                    <cac:FinancialInstitution>
                        <t t-set="foreach_vals" t-value="financial_inst_vals.get('FinancialInstitution_vals', {})"/>
                        <cbc:ID
                            t-att="foreach_vals.get('id_attrs', {})"
                            t-esc="foreach_vals.get('id')"/>
                        <cbc:Name t-esc="foreach_vals.get('name')"/>
                        <cac:Address>
                            <t t-call="{{AddressType_template}}">
                                <t t-set="vals" t-value="foreach_vals.get('Address_vals', {})"/>
                            </t>
                        </cac:Address>
                    </cac:FinancialInstitution>
                </cac:FinancialInstitutionBranch>
            </cac:PayeeFinancialAccount>
        </t>
    </template>

    <template id="ubl_20_TaxCategoryType">
        <t xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
           xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
           xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
            <cbc:ID
                t-att="vals.get('id_attrs', {})"
                t-esc="vals.get('id')"/>
            <cbc:Name t-esc="vals.get('name')"/>
            <cbc:Percent t-esc="vals.get('percent')"/>
            <!-- Only include below <TaxSubtotal>, not below <Item> -->
            <cbc:TaxExemptionReasonCode
                    t-esc="vals.get('tax_exemption_reason_code')"/>
            <cbc:TaxExemptionReason
                    t-esc="vals.get('tax_exemption_reason')"/>
            <cac:TaxScheme>
                <cbc:ID>VAT</cbc:ID>
            </cac:TaxScheme>
        </t>
    </template>

    <template id="ubl_20_TaxTotalType">
        <t xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
           xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
           xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
            <cbc:TaxAmount
                    t-att-currencyID="vals['currency'].name"
                    t-esc="format_float(vals.get('tax_amount'), vals.get('currency_dp'))"/>
            <t t-foreach="vals.get('TaxSubtotal_vals', [])" t-as="foreach_vals">
                <cac:TaxSubtotal>
                    <cbc:TaxableAmount
                        t-att-currencyID="foreach_vals['currency'].name"
                        t-esc="format_float(foreach_vals.get('taxable_amount'), foreach_vals.get('currency_dp'))"/>
                    <cbc:TaxAmount
                        t-att-currencyID="foreach_vals['currency'].name"
                        t-esc="format_float(foreach_vals.get('tax_amount'), foreach_vals.get('currency_dp'))"/>
                    <cbc:Percent t-esc="foreach_vals.get('percent')"/>
                    <cac:TaxCategory>
                        <t t-call="{{TaxCategoryType_template}}">
                            <t t-set="vals" t-value="foreach_vals.get('TaxCategory_vals', {})"/>
                        </t>
                    </cac:TaxCategory>
                </cac:TaxSubtotal>
            </t>
        </t>
    </template>

    <template id="ubl_20_AllowanceChargeType">
        <t xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
           xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
           xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
            <cbc:ChargeIndicator t-esc="vals.get('charge_indicator')"/>
            <cbc:AllowanceChargeReasonCode t-esc="vals.get('allowance_charge_reason_code')"/>
            <cbc:AllowanceChargeReason t-esc="vals.get('allowance_charge_reason')"/>
            <cbc:MultiplierFactorNumeric t-esc="vals.get('multiplier_factor')"/>
            <cbc:Amount
                    t-att-currencyID="vals.get('currency_name')"
                    t-esc="format_float(vals.get('amount'), vals.get('currency_dp'))"/>
            <t t-foreach="vals.get('TaxCategory_vals', [])" t-as="foreach_vals">
                <cac:TaxCategory>
                    <t t-call="{{TaxCategoryType_template}}">
                        <t t-set="vals" t-value="foreach_vals"/>
                    </t>
                </cac:TaxCategory>
            </t>
        </t>
    </template>

</odoo>
