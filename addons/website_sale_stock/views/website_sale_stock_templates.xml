<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Shopping Cart Lines -->
    <template id="website_sale_stock_cart_lines" inherit_id="website_sale.cart_lines" name="Shopping Cart Lines">
        <xpath expr="//input[@type='text'][hasclass('quantity')]" position="attributes">
          <attribute name='t-att-data-max'>(line.product_uom_qty + (line.product_id.free_qty - line.product_id.cart_qty)) if line.product_id.type == 'product' and not line.product_id.allow_out_of_stock_order else None</attribute>
        </xpath>
        <xpath expr="//div[hasclass('css_quantity')]//i[hasclass('fa-plus')]/.." position="replace">
          <t t-if="line._get_stock_warning(clear=False)">
            <div class="input-group-append">
                <a t-attf-href="#" class="btn btn-link">
                  <i class='fa fa-warning text-warning' t-att-title="line._get_stock_warning()" role="img" aria-label="Warning"/>
                </a>
            </div>
          </t>
          <t t-else="1">
            <t>$0</t>
          </t>
        </xpath>
        <xpath expr="//div[hasclass('css_quantity')]" position="after">
            <div class='availability_messages'/>
        </xpath>
        <xpath expr="//div[hasclass('js_cart_lines')]" position="after">
          <t t-if='website_sale_order'>
            <div t-if='website_sale_order._get_stock_warning(clear=False)' class="alert alert-warning" role="alert">
              <strong>Warning!</strong> <t t-esc='website_sale_order._get_stock_warning()'/>
            </div>
          </t>
        </xpath>
    </template>

  <template id="website_sale_stock_product" inherit_id="website_sale.product" priority="4">
      <xpath expr="//div[@id='o_wsale_cta_wrapper']" position="after">
      <div class="availability_messages o_not_editable">
        <t t-if="product.type == 'product'"><!-- show out_of_stock_message whatever the show_availability - pde's spec-->
            <div id="out_of_stock_message" t-if="free_qty &lt;= 0 and not cart_qty" t-attf-class="availability_message_#{product_template} text-danger font-weight-bold">
                <t t-out='product.out_of_stock_message'/>
                <t t-if="not product.allow_out_of_stock_order">Out of Stock</t>
            </div>
            <div id="threshold_message" t-elif="product.show_availability and free_qty &lt;= product.available_threshold" t-attf-class="availability_message_#{product_template} text-warning font-weight-bold">
                Only <t t-esc='int(free_qty) if free_qty.is_integer() else free_qty'/> <t t-esc="product.uom_name" /> left in stock.
            </div>

            <div t-if="not product.allow_out_of_stock_order and product.show_availability and cart_qty" t-attf-class="availability_message_#{product_template} text-warning mt8">
                <t t-if='not free_qty'>
                    You already added all the available product in your cart.
                </t>
                <t t-else=''>
                You already added <t t-esc="cart_qty" /> <t t-esc="uom_name" /> in your cart.
                </t>
            </div>
        </t>
      </div>
    </xpath>
      <xpath expr="//div[@id='o_wsale_cta_wrapper']" position="before">
          <t t-set="cart_qty" t-value="product.cart_qty if 'cart_qty' in product.fields_get() else product.product_variant_ids[:1].cart_qty"/>
          <!-- FIXME : Use _get_cart_qty() in master -->
          <t t-set="free_qty" t-value="product.with_context(warehouse=website._get_warehouse_available()).sudo().qty_available - cart_qty"/>
          <t t-set="display_add_to_cart" t-value="display_add_to_cart and free_qty &gt;= 1"/>
    </xpath>
  </template>

  <template id="website_sale_stock_payment" inherit_id="website_sale.cart_summary">
     <xpath expr="//table[@id='cart_products']//td[hasclass('td-qty')]" position="inside">
      <t t-if='line._get_stock_warning(clear=False)'>
        <i class='fa fa-warning text-warning' t-att-title="line._get_stock_warning()" role="img" aria-label="Warning"/>
      </t>
    </xpath>
    <xpath expr="//table[@id='cart_products']" position="after">
        <t t-if='website_sale_order'>
          <t t-set='warning' t-value='website_sale_order._get_stock_warning(clear=False)' />
          <div t-if='warning' class="alert alert-warning" role="alert">
            <strong>Warning!</strong> <t t-esc='website_sale_order._get_stock_warning()'/>
          </div>
        </t>
    </xpath>
  </template>
</odoo>
